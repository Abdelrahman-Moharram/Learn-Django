{% extends 'base.html' %}


{% block body %}
	
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add New Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
							<form method="post" enctype="multipart/form-data">
								{% csrf_token %}
								<div class="modal-body">
									
									<img src="" id="modal-thumbnail" alt="" class="w-100 my-3">
									<label for="file"  class="btn btn-primary"><i class="bi bi-cloud-arrow-up-fill"></i> upload file</label>
									<input type="file" id="file" name="file" class="d-none" onchange="loadFile(event)">
									</div>
									<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
									<button type="submit" class="btn btn-primary">Save</button>
								</div>
							</form>
    </div>
  </div>
</div>




<div class="container my-5">
	<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
		<i class="bi bi-plus"></i>	Add New
	</button>


	{% if files|length %}
	<table class="table table-primary text-center  my-5">
		<thead class="">
			<tr>
				<th scope="col">id</th>
				<th scope="col">file</th>
				<th scope="col">Uploaded At</th>
				<th scope="col">Type</th>
				<th scope="col">Download</th>
				<th scope="col">Delete</th>
			</tr>
		</thead>
		<tbody>
			
			
					{% for file in files %}

					<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="exampleModalLabel">Delete File</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<p class="h4 text-danger">Are you sure you want to <span class="font-weight-bold">Delete</span> this file ?</p>
									<img src="{{file.file.url}}" width="100%">
								</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
										<a href="{% url 'home:delete' file.id %}" class="btn btn-danger">Delete</a>
									</div>
							</div>
						</div>
					</div>
						<tr>
							<th scope="row">{{file.id}}</th>

							<td>

							{% if file.extension == 'excel'  %}
								<i class="width-70 bi bi-file-earmark-spreadsheet"></i>
							

							{% elif file.extension == 'csv' %}
								<i class="width-70 bi bi-filetype-csv"></i>
							

							{% elif file.extension == 'word' %}
								<i class="width-70 bi bi-file-earmark-word"></i>
							

							{% elif file.extension == 'word' %}
								<i class="width-70 bi bi-file-earmark-pdf"></i>
							

							{% elif file.extension == 'mp4' %}
								<i class="width-70 bi bi-filetype-mp4"></i>

							{% elif file.extension == 'txt' %}
								<i class="bi bi-filetype-txt"></i>

							{% elif file.extension == 'pptx' %}
								<i class="bi bi-filetype-pptx"></i>

							
							{% else %}
								<img src="{{file.file.url}}" width="70px">
							{% endif %}

							
						</td>
							<td>{{file.uploaded_at}}</td>
							<td>{{file.extension}}</td>
							<td><a href="{{file.file.url}}" class="btn btn-primary">Download</a></td>
							<td><button  data-bs-toggle="modal" data-bs-target="#deleteModal" class="btn btn-danger">Delete</button></td>
						</tr>
					{% endfor %}
					
					
				</tbody>
			</table>
			{% else %}

				<h1 class="text-center"><i class="bi bi-folder-fill"></i> No Files Available </h1>
		{% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

<script type="text/javascript">
	var loadFile = function(event) {
    var output = document.getElementById('modal-thumbnail');
    output.src = URL.createObjectURL(event.target.files[0]);
    output.onload = function() {
      URL.revokeObjectURL(output.src) // free memory
    }
  };

	$(document).on('submit', '#add-form', function(e){
		e.preventDefault()
		$.ajax({
			type : "post",
			url : "{% url 'home:index' %}",
			data:{
				file: $('#file').val(),
				csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
			},
			success: function(data){

			}
		})
	})
</script>

{% endblock body %}
	